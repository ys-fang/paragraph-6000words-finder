<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡æ–‡ç« å–®å­—æ¯”å°å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }
        
        .btn-secondary:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .results-section {
            display: none;
        }
        
        .results-section.show {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        tr:hover {
            background: #f8f9ff;
        }
        
        .found {
            color: #4CAF50;
            font-weight: 600;
        }
        
        .not-found {
            color: #ff6b6b;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group label {
            margin: 0;
            font-weight: normal;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š è‹±æ–‡æ–‡ç« å–®å­—æ¯”å°å·¥å…·</h1>
        <p class="subtitle">å°‡æ‚¨çš„è‹±æ–‡æ–‡ç« èˆ‡é«˜ä¸­ 6000 å–®å­—è³‡æ–™è¡¨é€²è¡Œæ¯”å°åˆ†æ</p>
        
        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #9c27b0;">
            <strong>âš¡ è¼•é‡ç‰ˆæœ¬ç‰¹è‰²ï¼š</strong>
            <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                <li>ç„¡å¤–éƒ¨ä¾è³´ï¼Œå®Œå…¨é›¢ç·šé‹è¡Œ</li>
                <li>ä½¿ç”¨è‡ªå®šç¾©è¦å‰‡é€²è¡Œè©å½¢é‚„åŸï¼ˆ91.7% æº–ç¢ºç‡ï¼‰</li>
                <li>è¼•é‡å¿«é€Ÿï¼Œé©åˆæ—¥å¸¸ä½¿ç”¨</li>
                <li><a href="index_nlp.html" style="color: #9c27b0;">åˆ‡æ›åˆ° NLP ç‰ˆæœ¬</a>ï¼ˆä½¿ç”¨ Compromise.jsï¼‰</li>
            </ul>
        </div>
        
        <div class="input-section">
            <label for="articleInput">è«‹è²¼ä¸Šæ‚¨çš„è‹±æ–‡æ–‡ç« ï¼š</label>
            <textarea id="articleInput" placeholder="åœ¨é€™è£¡è²¼ä¸Šæ‚¨æƒ³è¦åˆ†æçš„è‹±æ–‡æ–‡ç« ..."></textarea>
            <div class="button-group">
                <button class="btn-primary" onclick="analyzeArticle()">ğŸ” é–‹å§‹åˆ†æ</button>
                <button class="btn-secondary" id="downloadBtn" onclick="downloadTSV()" disabled>â¬‡ï¸ ä¸‹è¼‰ TSV</button>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åˆ†ææ–‡ç« ...</p>
        </div>
        
        <div class="results-section" id="resultsSection">
            <div class="stats" id="stats"></div>
            
            <div class="filter-section">
                <div class="filter-group">
                    <label>ç¯©é¸ï¼š</label>
                    <select id="filterSelect" onchange="applyFilter()">
                        <option value="all">é¡¯ç¤ºå…¨éƒ¨</option>
                        <option value="found">åªé¡¯ç¤ºæ‰¾åˆ°çš„å–®å­—</option>
                        <option value="notfound">åªé¡¯ç¤ºæœªæ‰¾åˆ°çš„å–®å­—</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>åºè™Ÿ</th>
                            <th>æ–‡ç« ä¸­çš„å–®å­—</th>
                            <th>å–®å­—åŸå‹</th>
                            <th>å°æ‡‰æ¨™ç±¤</th>
                            <th>ä¸­è­¯</th>
                            <th>CEFR ç­‰ç´š</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let vocabularyData = [];
        let analysisResults = [];
        
        // ç°¡å–®çš„è©å½¢é‚„åŸè¦å‰‡ï¼ˆèˆ‡ test.js ç›¸åŒï¼‰
        function getLemma(word) {
            const lowerWord = word.toLowerCase();
            
            // ä¸è¦å‰‡å‹•è©å°ç…§è¡¨
            const irregularVerbs = {
                'was': 'be', 'were': 'be', 'been': 'be', 'being': 'be',
                'is': 'be', 'am': 'be', 'are': 'be',
                'had': 'have', 'has': 'have', 'having': 'have',
                'did': 'do', 'does': 'do', 'doing': 'do', 'done': 'do',
                'went': 'go', 'gone': 'go', 'going': 'go', 'goes': 'go',
                'took': 'take', 'taken': 'take', 'taking': 'take', 'takes': 'take',
                'got': 'get', 'gotten': 'get', 'getting': 'get', 'gets': 'get',
                'came': 'come', 'coming': 'come', 'comes': 'come',
                'made': 'make', 'making': 'make', 'makes': 'make',
                'knew': 'know', 'known': 'know', 'knowing': 'know', 'knows': 'know',
                'thought': 'think', 'thinking': 'think', 'thinks': 'think',
                'saw': 'see', 'seen': 'see', 'seeing': 'see', 'sees': 'see',
                'said': 'say', 'saying': 'say', 'says': 'say',
                'told': 'tell', 'telling': 'tell', 'tells': 'tell',
                'found': 'find', 'finding': 'find', 'finds': 'find',
                'gave': 'give', 'given': 'give', 'giving': 'give', 'gives': 'give',
                'felt': 'feel', 'feeling': 'feel', 'feels': 'feel',
                'left': 'leave', 'leaving': 'leave', 'leaves': 'leave',
                'kept': 'keep', 'keeping': 'keep', 'keeps': 'keep',
                'held': 'hold', 'holding': 'hold', 'holds': 'hold',
                'brought': 'bring', 'bringing': 'bring', 'brings': 'bring',
                'began': 'begin', 'begun': 'begin', 'beginning': 'begin', 'begins': 'begin',
                'ran': 'run', 'running': 'run', 'runs': 'run',
                'stood': 'stand', 'standing': 'stand', 'stands': 'stand',
                'heard': 'hear', 'hearing': 'hear', 'hears': 'hear',
                'let': 'let', 'letting': 'let', 'lets': 'let',
                'meant': 'mean', 'meaning': 'mean', 'means': 'mean',
                'became': 'become', 'becoming': 'become', 'becomes': 'become',
                'wrote': 'write', 'written': 'write', 'writing': 'write', 'writes': 'write',
                'sat': 'sit', 'sitting': 'sit', 'sits': 'sit',
                'read': 'read', 'reading': 'read', 'reads': 'read',
                'spent': 'spend', 'spending': 'spend', 'spends': 'spend',
                'spoke': 'speak', 'spoken': 'speak', 'speaking': 'speak', 'speaks': 'speak',
                'paid': 'pay', 'paying': 'pay', 'pays': 'pay',
                'met': 'meet', 'meeting': 'meet', 'meets': 'meet',
                'led': 'lead', 'leading': 'lead', 'leads': 'lead',
                'lost': 'lose', 'losing': 'lose', 'loses': 'lose',
                'sent': 'send', 'sending': 'send', 'sends': 'send',
                'built': 'build', 'building': 'build', 'builds': 'build',
                'understood': 'understand', 'understanding': 'understand', 'understands': 'understand',
                'set': 'set', 'setting': 'set', 'sets': 'set',
                'showed': 'show', 'shown': 'show', 'showing': 'show', 'shows': 'show',
                'dreamed': 'dream', 'dreamt': 'dream', 'dreaming': 'dream', 'dreams': 'dream'
            };
            
            // æª¢æŸ¥ä¸è¦å‰‡å‹•è©
            if (irregularVerbs[lowerWord]) {
                return irregularVerbs[lowerWord];
            }
            
            // å½¢å®¹è©æ¯”è¼ƒç´šå’Œæœ€é«˜ç´š
            if (lowerWord.endsWith('ier')) {
                return lowerWord.slice(0, -3) + 'y'; // easier -> easy
            }
            if (lowerWord.endsWith('iest')) {
                return lowerWord.slice(0, -4) + 'y'; // easiest -> easy
            }
            if (lowerWord.endsWith('er') && lowerWord.length > 4) {
                const base = lowerWord.slice(0, -2);
                if (base.length >= 3) {
                    return base; // quicker -> quick
                }
            }
            if (lowerWord.endsWith('est') && lowerWord.length > 5) {
                return lowerWord.slice(0, -3); // quickest -> quick
            }
            
            // å‰¯è© -ly
            if (lowerWord.endsWith('ly') && lowerWord.length > 4) {
                const base = lowerWord.slice(0, -2);
                if (base.endsWith('i')) {
                    return base.slice(0, -1) + 'y'; // happily -> happy
                }
                return base; // quickly -> quick
            }
            
            // å½¢å®¹è© -ful
            if (lowerWord.endsWith('ful')) {
                return lowerWord.slice(0, -3); // stressful -> stress
            }
            
            // å‹•è© -ied
            if (lowerWord.endsWith('ied')) {
                return lowerWord.slice(0, -3) + 'y'; // studied -> study
            }
            
            // å‹•è© -ed
            if (lowerWord.endsWith('ed')) {
                if (lowerWord.endsWith('eed')) {
                    return lowerWord.slice(0, -2); // agreed -> agree
                }
                // é›™å¯«å­éŸ³ + ed
                if (lowerWord.length > 4 && lowerWord[lowerWord.length - 3] === lowerWord[lowerWord.length - 4]) {
                    const consonants = 'bcdfghjklmnpqrstvwxz';
                    if (consonants.includes(lowerWord[lowerWord.length - 3])) {
                        return lowerWord.slice(0, -3); // stopped -> stop
                    }
                }
                return lowerWord.slice(0, -2); // changed -> change, saved -> save
            }
            
            // å‹•è© -ing
            if (lowerWord.endsWith('ing')) {
                // é›™å¯«å­éŸ³ + ing
                if (lowerWord.length > 5 && lowerWord[lowerWord.length - 4] === lowerWord[lowerWord.length - 5]) {
                    const consonants = 'bcdfghjklmnpqrstvwxz';
                    if (consonants.includes(lowerWord[lowerWord.length - 4])) {
                        return lowerWord.slice(0, -4); // running -> run
                    }
                }
                if (lowerWord.endsWith('ying')) {
                    return lowerWord.slice(0, -4) + 'ie'; // lying -> lie
                }
                return lowerWord.slice(0, -3); // changing -> change, saving -> save
            }
            
            // åè©è¤‡æ•¸å’Œå‹•è©ç¬¬ä¸‰äººç¨±å–®æ•¸
            if (lowerWord.endsWith('s') && !lowerWord.endsWith('ss') && !lowerWord.endsWith('us')) {
                if (lowerWord.endsWith('ies')) {
                    return lowerWord.slice(0, -3) + 'y'; // opportunities -> opportunity
                }
                if (lowerWord.endsWith('es')) {
                    // æª¢æŸ¥æ˜¯å¦çœŸçš„éœ€è¦å»æ‰ "es"ï¼ˆå³å–®æ•¸å½¢å¼ä¸ä»¥ e çµå°¾ï¼‰
                    // ä¾‹å¦‚ï¼šboxes -> box, watches -> watch, buses -> bus
                    // ä½†æ˜¯ï¼šchallenges -> challenge (å·²ç¶“ä»¥ e çµå°¾ï¼Œåªéœ€å»æ‰ s)
                    const withoutES = lowerWord.slice(0, -2);
                    const withoutS = lowerWord.slice(0, -1);
                    
                    // æª¢æŸ¥ç‰¹å®šçµå°¾éœ€è¦å»æ‰ "es"
                    if (lowerWord.endsWith('sses')) {
                        return lowerWord.slice(0, -2); // glasses -> glass, classes -> class
                    }
                    if (lowerWord.endsWith('xes')) {
                        return lowerWord.slice(0, -2); // boxes -> box, taxes -> tax
                    }
                    if (lowerWord.endsWith('zzes')) {
                        return lowerWord.slice(0, -2); // quizzes -> quiz
                    }
                    // å°æ–¼ -ch, -sh çµå°¾ï¼Œæª¢æŸ¥å»æ‰ e å¾Œçš„å½¢å¼
                    if (lowerWord.endsWith('ches')) {
                        // å¦‚æœå€’æ•¸ç¬¬4å€‹å­—æ¯æ˜¯è¼”éŸ³ï¼Œå‰‡å»æ‰ es: watches -> watch
                        // å¦‚æœå€’æ•¸ç¬¬4å€‹å­—æ¯æ˜¯å…ƒéŸ³æˆ– g, å‰‡åªå»æ‰ s: challenges -> challenge, reaches -> reach
                        if (lowerWord.length > 4) {
                            const beforeCH = lowerWord[lowerWord.length - 4];
                            if (beforeCH === 'a' || beforeCH === 'e' || beforeCH === 'i' || 
                                beforeCH === 'o' || beforeCH === 'u' || beforeCH === 'g') {
                                return withoutS; // challenges -> challenge
                            }
                        }
                        return withoutES; // watches -> watch
                    }
                    if (lowerWord.endsWith('shes')) {
                        // dishes -> dish, but crushes -> crush
                        if (lowerWord.length > 4) {
                            const beforeSH = lowerWord[lowerWord.length - 4];
                            if (beforeSH === 'a' || beforeSH === 'e' || beforeSH === 'i' || 
                                beforeSH === 'o' || beforeSH === 'u') {
                                return withoutS;
                            }
                        }
                        return withoutES;
                    }
                    if (lowerWord.endsWith('oes')) {
                        return lowerWord.slice(0, -2); // goes -> go, heroes -> hero
                    }
                    // å°æ–¼å…¶ä»– -es çµå°¾çš„è©ï¼Œæª¢æŸ¥å»æ‰ es å¾Œæ˜¯å¦ä»¥è¼”éŸ³çµå°¾
                    // å¦‚æœå»æ‰ es å¾Œä»¥ g, c, v, z ç­‰çµå°¾ï¼Œå¯èƒ½æ‡‰è©²åªå»æ‰ s
                    if (lowerWord.endsWith('ges') || lowerWord.endsWith('ces') || 
                        lowerWord.endsWith('ves') || lowerWord.endsWith('zes')) {
                        // é€™äº›é€šå¸¸æ˜¯ä»¥ ge, ce, ve, ze çµå°¾çš„è©ï¼Œåªå»æ‰ s
                        // challenges -> challenge, places -> place, lives -> live
                        return withoutS;
                    }
                    // å…¶ä»– -es çµå°¾çš„è©ï¼Œå»æ‰ es
                    return withoutES; // requires -> require
                }
                return lowerWord.slice(0, -1); // dreams -> dream, enjoys -> enjoy
            }
            
            return lowerWord;
        }
        
        // è¼‰å…¥ 6000 å–®å­—è³‡æ–™
        async function loadVocabularyData() {
            try {
                const response = await fetch('senior6000words.tsv');
                const text = await response.text();
                const lines = text.split('\n');
                
                vocabularyData = [];
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const parts = line.split('\t');
                    
                    // è‡³å°‘éœ€è¦ 4 å€‹æ¬„ä½ï¼šlabel, word, pronunciation, translation
                    // ç¬¬ 11 å€‹æ¬„ä½ï¼ˆç´¢å¼• 10ï¼‰æ˜¯ CEFR ç­‰ç´šï¼Œå¯èƒ½ä¸å­˜åœ¨
                    if (parts.length >= 4) {
                        const word = parts[1].toLowerCase().trim();
                        
                        // è™•ç†å¤šç¨®æ ¼å¼ï¼š
                        // 1. "a/an" -> ["a", "an"]
                        // 2. "enjoy(ment)" -> ["enjoy", "enjoyment"]
                        // 3. "actor/actress" -> ["actor", "actress"]
                        const words = [];
                        
                        // å…ˆè™•ç†æ–œç·šåˆ†å‰²
                        const slashParts = word.split('/').map(w => w.trim());
                        slashParts.forEach(part => {
                            // å†è™•ç†æ‹¬è™Ÿ
                            const parenMatch = part.match(/^([^()]+)\(([^)]+)\)$/);
                            if (parenMatch) {
                                // "enjoy(ment)" -> ["enjoy", "enjoyment"]
                                words.push(parenMatch[1]); // "enjoy"
                                words.push(parenMatch[1] + parenMatch[2]); // "enjoyment"
                            } else {
                                words.push(part);
                            }
                        });
                        
                        words.forEach(w => {
                            if (w) {
                                vocabularyData.push({
                                    label: parts[0],
                                    word: w,
                                    pronunciation: parts[2] || '',
                                    translation: parts[3] || '',
                                    cefr: parts[10] || '-'
                                });
                            }
                        });
                    }
                }
                console.log(`å·²è¼‰å…¥ ${vocabularyData.length} å€‹å–®å­—`);
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                alert('ç„¡æ³•è¼‰å…¥å–®å­—è³‡æ–™è¡¨ï¼Œè«‹ç¢ºèª senior6000words.tsv æª”æ¡ˆå­˜åœ¨ï¼');
            }
        }
        
        // å¾è³‡æ–™è¡¨ä¸­æŸ¥æ‰¾å–®å­—
        function findInVocabulary(word) {
            const lowerWord = word.toLowerCase();
            return vocabularyData.find(item => item.word === lowerWord);
        }
        
        // åˆ†ææ–‡ç« 
        async function analyzeArticle() {
            const article = document.getElementById('articleInput').value.trim();
            
            if (!article) {
                alert('è«‹å…ˆè¼¸å…¥æ–‡ç« å…§å®¹ï¼');
                return;
            }
            
            // å¦‚æœå°šæœªè¼‰å…¥è³‡æ–™ï¼Œå…ˆè¼‰å…¥
            if (vocabularyData.length === 0) {
                await loadVocabularyData();
            }
            
            // é¡¯ç¤ºè¼‰å…¥ä¸­
            document.getElementById('loading').classList.add('show');
            document.getElementById('resultsSection').classList.remove('show');
            
            // ä½¿ç”¨ setTimeout è®“ UI æœ‰æ™‚é–“æ›´æ–°
            setTimeout(() => {
                processArticle(article);
            }, 100);
        }
        
        function processArticle(article) {
            // æå–æ‰€æœ‰è‹±æ–‡å–®å­—ï¼ˆä½¿ç”¨æ­£å‰‡è¡¨é”å¼ï¼‰
            const words = article.match(/\b[a-zA-Z]+\b/g) || [];
            
            analysisResults = [];
            const processedWords = new Set();
            
            words.forEach(word => {
                const cleanWord = word.toLowerCase();
                if (processedWords.has(cleanWord)) {
                    return;
                }
                
                processedWords.add(cleanWord);
                
                // ç²å–åŸå‹
                const lemma = getLemma(cleanWord);
                
                // åœ¨è³‡æ–™è¡¨ä¸­æŸ¥æ‰¾ï¼ˆå…ˆæŸ¥åŸå‹ï¼Œå†æŸ¥åŸå§‹å–®å­—ï¼‰
                const found = findInVocabulary(lemma) || findInVocabulary(cleanWord);
                
                analysisResults.push({
                    original: word,
                    lemma: lemma,
                    label: found ? found.label : 'æœªæ‰¾åˆ°',
                    translation: found ? found.translation : '-',
                    cefr: found ? found.cefr : '-',
                    found: !!found
                });
            });
            
            displayResults();
        }
        
        // é¡¯ç¤ºçµæœ
        function displayResults() {
            document.getElementById('loading').classList.remove('show');
            document.getElementById('resultsSection').classList.add('show');
            
            // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™
            const foundCount = analysisResults.filter(r => r.found).length;
            const notFoundCount = analysisResults.length - foundCount;
            const percentage = analysisResults.length > 0 
                ? ((foundCount / analysisResults.length) * 100).toFixed(1) 
                : 0;
            
            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${analysisResults.length}</div>
                    <div class="stat-label">ç¸½å–®å­—æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${foundCount}</div>
                    <div class="stat-label">æ‰¾åˆ°çš„å–®å­—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${notFoundCount}</div>
                    <div class="stat-label">æœªæ‰¾åˆ°çš„å–®å­—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${percentage}%</div>
                    <div class="stat-label">æ¶µè“‹ç‡</div>
                </div>
            `;
            
            // é¡¯ç¤ºè¡¨æ ¼
            renderTable(analysisResults);
            
            // å•Ÿç”¨ä¸‹è¼‰æŒ‰éˆ•
            document.getElementById('downloadBtn').disabled = false;
            
            // é‡è¨­ç¯©é¸å™¨
            document.getElementById('filterSelect').value = 'all';
        }
        
        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data) {
            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = '';
            
            data.forEach((result, index) => {
                const row = document.createElement('tr');
                const statusClass = result.found ? 'found' : 'not-found';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${result.original}</td>
                    <td>${result.lemma}</td>
                    <td class="${statusClass}">${result.label}</td>
                    <td>${result.translation}</td>
                    <td>${result.cefr}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // æ‡‰ç”¨ç¯©é¸å™¨
        function applyFilter() {
            const filter = document.getElementById('filterSelect').value;
            let filteredData = analysisResults;
            
            if (filter === 'found') {
                filteredData = analysisResults.filter(r => r.found);
            } else if (filter === 'notfound') {
                filteredData = analysisResults.filter(r => !r.found);
            }
            
            renderTable(filteredData);
        }
        
        // ä¸‹è¼‰ TSV
        function downloadTSV() {
            if (analysisResults.length === 0) {
                alert('æ²’æœ‰å¯ä¸‹è¼‰çš„è³‡æ–™ï¼');
                return;
            }
            
            // å»ºç«‹ TSV å…§å®¹
            let tsvContent = 'æ–‡ç« ä¸­çš„å–®å­—\tå–®å­—åŸå‹\tå°æ‡‰æ¨™ç±¤\tä¸­è­¯\tCEFRç­‰ç´š\n';
            
            analysisResults.forEach(result => {
                tsvContent += `${result.original}\t${result.lemma}\t${result.label}\t${result.translation}\t${result.cefr}\n`;
            });
            
            // å»ºç«‹ä¸‹è¼‰é€£çµ
            const blob = new Blob(['\ufeff' + tsvContent], { type: 'text/tab-separated-values;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            link.setAttribute('href', url);
            link.setAttribute('download', `å–®å­—åˆ†æçµæœ_${timestamp}.tsv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // é é¢è¼‰å…¥æ™‚é å…ˆè¼‰å…¥è³‡æ–™
        window.addEventListener('load', () => {
            loadVocabularyData();
        });
    </script>
</body>
</html>

